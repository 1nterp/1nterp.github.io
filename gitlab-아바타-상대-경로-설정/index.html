<!doctype html><html lang=ko-kr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Gitlab 아바타/첨부파일 상대 경로 설정 &#183; InterP Blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link href rel=alternate type=application/rss+xml title="InterP Blog"></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>InterP Blog</h2></a><ul></ul></div></nav><main><div class=post><div class=post-info><time datetime="2018-01-08 02:35:20 +0000 UTC">2018년 1월 8일</time></div><h1 class=post-title>Gitlab 아바타/첨부파일 상대 경로 설정</h1><div class=post-line></div><p>Gitlab의 <code>External_Url</code> 을 실제 서버 주소와 다르게 설정할 때엔, 실제 nginx 에도 해당 도메인으로 접근할 수 있도록 설정해야 하는 게 맞다. 그렇지 않으면, 첨부파일과 아바타 이미지가 모두 깨져나온다. 하지만 그러기 전에 Gitlab 차원에서 상대 경로로 아바타를 출력할 수 있도록 수정하는 방법 &lsquo;도&rsquo; 있으니 편법으로 수정했다.</p><h3 id=아바타-상대-경로-설정>아바타 상대 경로 설정</h3><p><code>/opt/gitlab/embedded/service/gitlab-rails/app/models/concerns/avatarable.rb</code> 파일에서 절대 경로로 수정하는 코드가 있는데, url_base 에 덧붙이는 코드들을 전부 주석처리하면 된다.</p><p>당연히 <code>gitlab-ctl reconfigure && gitlab-ctl restart</code> 를 해 줘야 한다.</p><p>참고 : <a href=https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/11001/diffs#note_28659864>https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/11001/diffs#note_28659864</a></p><h3 id=첨부파일-상대-경로-설정>첨부파일 상대 경로 설정</h3><p>단서가 없어서 맨땅에 헤딩하듯이 뒤지고 다녔다. Markdown 언어에서 링크를 담당하는 라이브러리가 있는데, 이름이 &lsquo;<strong>banzai</strong>&rsquo; 이다 (…) 무슨 생각으로 이름을 지은건지 도저히 모르겠지만 여기를 수정해야 한다.</p><p><code>filter/upload_link_filter.rb</code> 를 보면, <code>build_url()</code> 이란 함수가 있다. 여기서 Geo node 여부에 따라 base_path 를 설정하는 코드가 있는데, 여기서 원하는 내부 주소로 변경하면 된다.</p><p>Gitlab 11 로 버전이 업그레이드 되면서 해당 파일이 삭제되고, <code>absolute_link_filter.rb</code> 와 <code>external_link_filter.rb</code> , <code>relative_link_filter.rb</code> 가 남아있다. 여기 있는 <code>Gitlab.config.gitlab.url</code> (relative…rb 의 경우 <code>Gitlab.config.gitlab.base_url</code>) 을 원하는 주소로 바꿔주면 가능하다.</p></div><div class=pagination><a href=/%EB%8C%80%ED%99%94%EB%8A%94-%ED%95%84%EC%9A%94%ED%95%B4/ class="left arrow">&#8592;</a>
<a href=/java-web-application-%EC%9E%85%EB%AC%B8-1-%EC%A4%80%EB%B9%84%EC%9A%B4%EB%8F%99/ class="right arrow">&#8594;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2020-09-06 21:18:24.320642273 +0000 UTC m=+0.229469822">2020</time> InterP. 이 사이트는 <a href=https://gohugo.io>Hugo</a> 로 작성되었으며 <a href=https://github.com/EmielH/tale-hugo/>Tale</a> 테마를 사용합니다!</span></footer></body></html>